<!-- Auction Detail View Component with Fixed Image Carousel -->
<div class="bg-white rounded-lg border border-slate-200 shadow-lg p-6">
    <!-- Header with Back Button -->
    <div class="flex justify-between items-start mb-6">
        <button
            onclick="loadAuctions()"
            class="flex items-center text-slate-600 hover:text-slate-900 transition"
        >
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
            </svg>
            Back to List
        </button>
        
        <!-- Action Buttons -->
        <div class="flex gap-2">
            <button
                onclick="openEditModal({{ auction.id }})"
                class="px-4 py-2 text-slate-700 bg-slate-100 hover:bg-slate-200 rounded-lg transition font-medium"
                title="Edit"
            >
                <svg class="w-5 h-5 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                </svg>
                Edit
            </button>
            <button
                hx-delete="/api/auctions/{{ auction.id }}"
                hx-confirm="Delete this auction? This cannot be undone."
                onclick="setTimeout(() => loadAuctions(), 500)"
                class="px-4 py-2 text-white bg-red-600 hover:bg-red-700 rounded-lg transition font-medium"
                title="Delete"
            >
                <svg class="w-5 h-5 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                </svg>
                Delete
            </button>
        </div>
    </div>

    <!-- Image Carousel/Gallery Section -->
    {% if auction.image_path or auction.image_paths %}
    <div class="mb-6 rounded-lg overflow-hidden shadow-md bg-slate-100">
        <div id="carousel-container" class="relative flex items-center justify-center max-h-[600px] bg-slate-100">
            <!-- Main Image Display -->
            <img 
                id="carousel-image"
                src="/uploads/{{ auction.image_path }}" 
                alt="{{ auction.title }}" 
                class="w-full h-auto max-h-[600px] object-contain"
                loading="lazy"
            >

            <!-- Previous Button -->
            <button
                id="carousel-prev"
                onclick="prevImage()"
                class="absolute left-4 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-2 transition"
                style="display: none;"
            >
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
            </button>

            <!-- Next Button -->
            <button
                id="carousel-next"
                onclick="nextImage()"
                class="absolute right-4 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-2 transition"
                style="display: none;"
            >
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </button>
        </div>

        <!-- Carousel Indicators (Dots) -->
        <div id="carousel-indicators" class="flex justify-center gap-2 bg-slate-100 py-3" style="display: none;">
            <!-- Dots will be added by JavaScript -->
        </div>
    </div>
    {% endif %}

    <!-- Auction Title -->
    <h1 class="text-3xl font-serif font-bold text-slate-900 mb-4">
        {{ auction.title }}
    </h1>

    <!-- Meta Information -->
    <div class="flex items-center gap-4 pb-4 mb-6 border-b border-slate-200">
        <div class="flex items-center text-sm text-slate-600">
            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
            </svg>
            <span>By <strong class="text-slate-900">{{ auction.author }}</strong></span>
        </div>
        <span class="text-slate-300">•</span>
        <div class="flex items-center text-sm text-slate-600">
            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
            <span>Created: <strong>{{ auction.create_at.strftime('%B %d, %Y at %I:%M %p') }}</strong></span>
        </div>
        {% if auction.update_at != auction.create_at %}
        <span class="text-slate-300">•</span>
        <div class="flex items-center text-sm text-slate-600">
            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
            </svg>
            <span>Updated: <strong>{{ auction.update_at.strftime('%B %d, %Y at %I:%M %p') }}</strong></span>
        </div>
        {% endif %}
    </div>

    <!-- Auction Content -->
    <div class="prose prose-slate max-w-none">
        <div class="text-slate-700 leading-relaxed whitespace-pre-wrap">{{ auction.content }}</div>
    </div>

    <!-- Footer Actions -->
    <div class="mt-8 pt-6 border-t border-slate-200 flex justify-between items-center">
        <button
            onclick="loadAuctions()"
            class="px-4 py-2 text-slate-700 bg-slate-100 hover:bg-slate-200 rounded-lg transition font-medium"
        >
            ← Back to Auctions
        </button>
        
        <div class="text-sm text-slate-500">
            ID: #{{ auction.id }}
        </div>
    </div>
</div>

<script>
    // ========================================================================
    // CAROUSEL MANAGEMENT - FIXED FOR MULTIPLE IMAGES
    // ========================================================================
    
    let carouselImages = [];
    let currentImageIndex = 0;

    // Initialize carousel with images
    function initializeCarousel() {
        // Get primary image
        const primaryImage = '{{ auction.image_path }}';
        
        // Get images from image_paths JSON
        {% if auction.image_paths %}
        try {
            // Parse the JSON string from image_paths
            const imagePaths = {{ auction.image_paths | safe }};
            console.log('[CAROUSEL] Parsed image_paths:', imagePaths);
            
            if (Array.isArray(imagePaths) && imagePaths.length > 0) {
                carouselImages = imagePaths;
            } else if (primaryImage) {
                carouselImages = [primaryImage];
            }
        } catch (e) {
            console.error('[CAROUSEL] Error parsing image_paths:', e);
            if (primaryImage) {
                carouselImages = [primaryImage];
            }
        }
        {% else %}
        // Fallback to primary image if no image_paths
        if (primaryImage) {
            carouselImages = [primaryImage];
        }
        {% endif %}
        
        console.log('[CAROUSEL] Total images found:', carouselImages.length);
        console.log('[CAROUSEL] Images:', carouselImages);
        
        // Show/hide buttons based on number of images
        if (carouselImages.length > 1) {
            console.log('[CAROUSEL] Multiple images detected - showing controls');
            document.getElementById('carousel-prev').style.display = 'block';
            document.getElementById('carousel-next').style.display = 'block';
            document.getElementById('carousel-indicators').style.display = 'flex';
            
            // Create indicator dots
            createIndicators();
        } else {
            console.log('[CAROUSEL] Single image - hiding controls');
        }
        
        // Set first image
        if (carouselImages.length > 0) {
            updateCarousel(0);
        }
    }

    // Create indicator dots
    function createIndicators() {
        const indicatorContainer = document.getElementById('carousel-indicators');
        indicatorContainer.innerHTML = ''; // Clear existing
        
        carouselImages.forEach((_, index) => {
            const dot = document.createElement('button');
            dot.type = 'button';
            dot.className = 'w-2 h-2 rounded-full transition-all ';
            
            if (index === 0) {
                dot.className += 'bg-slate-700 w-6';
            } else {
                dot.className += 'bg-slate-400 hover:bg-slate-500';
            }
            
            dot.onclick = (e) => {
                e.preventDefault();
                updateCarousel(index);
            };
            
            indicatorContainer.appendChild(dot);
        });
    }

    // Update carousel display
    function updateCarousel(index) {
        if (carouselImages.length === 0) {
            console.error('[CAROUSEL] No images to display');
            return;
        }
        
        // Validate index
        if (index < 0) index = carouselImages.length - 1;
        if (index >= carouselImages.length) index = 0;
        
        currentImageIndex = index;
        
        // Update image
        const imagePath = carouselImages[index];
        const imgElement = document.getElementById('carousel-image');
        const fullPath = '/uploads/' + imagePath;
        
        console.log('[CAROUSEL] Updating to image', index, ':', imagePath);
        imgElement.src = fullPath;
        imgElement.alt = `{{ auction.title }} - Image ${index + 1}`;
        
        // Update indicators
        updateIndicators();
    }

    // Update indicator dots
    function updateIndicators() {
        const dots = document.querySelectorAll('#carousel-indicators button');
        dots.forEach((dot, index) => {
            if (index === currentImageIndex) {
                dot.className = 'w-6 h-2 rounded-full transition-all bg-slate-700';
            } else {
                dot.className = 'w-2 h-2 rounded-full transition-all bg-slate-400 hover:bg-slate-500';
            }
        });
    }

    // Navigation functions
    function prevImage() {
        console.log('[CAROUSEL] Previous clicked. Current:', currentImageIndex);
        updateCarousel(currentImageIndex - 1);
    }

    function nextImage() {
        console.log('[CAROUSEL] Next clicked. Current:', currentImageIndex);
        updateCarousel(currentImageIndex + 1);
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
        console.log('[CAROUSEL] Initializing carousel');
        initializeCarousel();
    });

    // Also initialize immediately in case DOMContentLoaded already fired
    if (document.readyState !== 'loading') {
        console.log('[CAROUSEL] DOM already loaded, initializing now');
        initializeCarousel();
    }
</script>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap');
    
    .font-serif {
        font-family: 'Merriweather', serif;
    }
    
    .prose {
        font-size: 1rem;
        line-height: 1.75;
    }
    
    .whitespace-pre-wrap {
        white-space: pre-wrap;
        word-wrap: break-word;
    }

    /* Carousel responsive sizing */
    @media (max-width: 768px) {
        #carousel-image {
            max-height: 400px;
        }
    }

    @media (max-width: 480px) {
        #carousel-image {
            max-height: 300px;
        }
    }
</style>